---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getAllNotes, getCategories, type Note } from '../../lib/notes';

const currentPath = Astro.url.pathname;
const lang = 'id';

const title = 'Catatan Saya - Syaiful Anam';
const description = 'Buku catatan publik saya tempat saya mendokumentasikan eksperimen, berbagi pemikiran tentang teknologi, dan melacak kemajuan saya sebagai pembangun seumur hidup.';

// Fetch notes from markdown files
const notes = await getAllNotes(lang);
const categories = ['Semua Catatan', ...await getCategories(lang)];

// Format date helper
const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString('id-ID', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
};
---

<Layout title={title} description={description} lang={lang}>
	<div class="container">
		<Header currentPath={currentPath} lang={lang} />

		<main class="main-content" >
			<div class="log-content">
				<h1 style="text-align: center;">Catatan Pembelajaran Saya</h1>

				<div class="intro-section">
					<p>
						Ini adalah buku catatan publik saya. Di sinilah saya mendokumentasikan eksperimen, berbagi pemikiran tentang teknologi,
						dan melacak kemajuan. Semua di sini adalah karya yang sedang berjalan, sama seperti saya.
					</p>
				</div>

				<div class="search-section">
					<input
						type="text"
						id="search-input"
						placeholder="Cari catatan berdasarkan judul atau konten..."
						class="search-input"
					/>
				</div>

				<div class="filters">
					{categories.map((category) => (
						<button
							class="filter-btn active"
							data-category={category === 'Semua Catatan' ? 'all' : category}
						>
							{category}
						</button>
					))}
				</div>

			<div class="log-list">
					{notes.map((note) => (
						<a href={`/id/notes/${note.slug}`} class="log-item-link">
							<article class="log-item" data-category={note.category} data-title={note.title.toLowerCase()} data-content={(note.summary || '').toLowerCase()} data-tags={(note.tags?.join(' ') || '').toLowerCase()}>
								{note.headerImage && (
									<div class="log-image">
										<img src={note.headerImage} alt={note.title} loading="lazy" />
									</div>
								)}
								<div class="log-header">
									<div class="log-meta">
										<time datetime={note.publishedDate} class="log-date">
											{formatDate(note.publishedDate)}
										</time>
										<span class="log-category">{note.category}</span>
									</div>
								</div>

								<div class="log-content">
									<h2 class="log-title">
										{note.title}
									</h2>
									{note.summary && <p class="log-summary">{note.summary}</p>}

									{note.tags && note.tags.length > 0 && (
										<div class="log-tags">
											{note.tags.map((tagItem) => (
												<span class="tag" data-tag={tagItem}>{tagItem}</span>
											))}
										</div>
									)}

									<span class="read-more">
										Baca selengkapnya â†’
									</span>
								</div>
							</article>
						</a>
					))}
				</div>

				{notes.length === 0 && (
					<div class="empty-state">
						<p>Belum ada catatan yang diterbitkan. Periksa kembali segera!</p>
					</div>
				)}

				<div class="footer-note">
					<p>
						<strong>Sedang Dalam Pengerjaan:</strong> Catatan pembelajaran ini terus berkembang saat saya mendokumentasikan perjalanan saya.
						Beberapa post mungkin draft kasar, lainnya mungkin tutorial detail. Semua mewakili pengalaman belajar yang nyata.
					</p>
				</div>
			</div>
		</main>
		<Footer lang={lang} />
	</div>
</Layout>

<style>
	.main-content {
		min-height: calc(100vh - 200px);
	}

	.log-content {
		padding: 0;
	}

	.intro-section {
		text-align: center;
		margin-bottom: var(--spacing-xl);
	}

	.intro-section p {
		font-size: 1.125rem;
		color: var(--color-text-secondary);
		max-width: 600px;
		margin: 0 auto;
	}

	.search-section {
		margin-bottom: var(--spacing-lg);
	}

	.search-input {
		width: 100%;
		max-width: 600px;
		margin: 0 auto;
		display: block;
		padding: var(--spacing-md);
		font-size: 1rem;
		font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		border: 1px solid var(--color-border);
		border-radius: 8px;
		background-color: var(--color-background);
		color: var(--color-text);
		outline: none;
		transition: border-color 0.2s ease, box-shadow 0.2s ease;
	}

	.search-input:focus {
		border-color: var(--color-accent);
		box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
	}

	.search-input::placeholder {
		color: var(--color-text-light);
	}

	.filters {
		display: flex;
		flex-wrap: wrap;
		gap: var(--spacing-sm);
		justify-content: center;
		margin-bottom: var(--spacing-xl);
		padding: var(--spacing-md);
		background-color: var(--color-surface);
		border: 1px solid var(--color-border);
		border-radius: 12px;
	}

	.filter-btn {
		padding: var(--spacing-xs) var(--spacing-md);
		border: 1px solid var(--color-border);
		background-color: var(--color-background);
		color: var(--color-text-secondary);
		border-radius: 20px;
		cursor: pointer;
		font-size: 0.875rem;
		font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		font-weight: 500;
		transition: all 0.2s ease;
	}

	.filter-btn:hover,
	.filter-btn.active {
		background-color: var(--color-accent);
		color: white;
		border-color: var(--color-accent);
	}

	.log-list {
		display: grid;
		gap: var(--spacing-lg);
		margin-bottom: var(--spacing-xl);
	}

	.log-item-link {
		text-decoration: none;
		color: inherit;
		display: block;
	}

	.log-item {
		background-color: var(--color-surface);
		border: 1px solid var(--color-border);
		border-radius: 12px;
		padding: var(--spacing-lg);
		transition: all 0.3s ease;
	}

	.log-item-link:hover .log-item {
		transform: translateY(-2px);
		border-color: var(--color-accent);
		box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
	}

	.log-header {
		margin-bottom: var(--spacing-md);
	}

	.log-meta {
		display: flex;
		align-items: center;
		gap: var(--spacing-sm);
		font-size: 0.875rem;
	}

	.log-date {
		color: var(--color-text-light);
	}

	.log-category {
		background-color: var(--color-accent);
		color: white;
		padding: 2px var(--spacing-sm);
		border-radius: 12px;
		font-weight: 600;
		font-size: 0.75rem;
	}

	.log-image {
		width: 100%;
		height: auto;
		border-radius: 8px;
		overflow: hidden;
		margin-bottom: var(--spacing-md);
	}

	.log-image img {
		width: 100%;
		height: auto;
		display: block;
	}

	.empty-state {
		text-align: center;
		padding: var(--spacing-2xl);
		color: var(--color-text-secondary);
	}

	.log-title {
		color: var(--color-text);
		margin: 0 0 var(--spacing-sm) 0;
		font-size: 1.25rem;
	}

	.log-summary {
		color: var(--color-text-secondary);
		margin-bottom: var(--spacing-md);
		line-height: 1.6;
	}

	.log-tags {
		display: flex;
		flex-wrap: wrap;
		gap: var(--spacing-xs);
		margin-bottom: var(--spacing-md);
	}

	.tag {
		background-color: var(--color-border);
		color: var(--color-text-secondary);
		padding: 2px var(--spacing-sm);
		border-radius: 12px;
		font-size: 0.75rem;
		font-weight: 500;
	}

	.read-more {
		display: inline-flex;
		align-items: center;
		color: var(--color-accent);
		font-weight: 600;
		text-decoration: none;
		transition: all 0.2s ease;
		font-size: 0.875rem;
	}

	.read-more:hover {
		color: var(--color-accent-hover);
		transform: translateX(4px);
	}

	.footer-note {
		background-color: var(--color-surface);
		border: 1px solid var(--color-border);
		border-radius: 12px;
		padding: var(--spacing-lg);
		text-align: center;
	}

	.footer-note p {
		color: var(--color-text-secondary);
		margin: 0;
		font-size: 0.875rem;
	}

	.footer-note strong {
		color: var(--color-text);
	}

	/* Responsive design */
	@media (max-width: 768px) {
		.log-content {
			padding: 0;
		}

		.filters {
			justify-content: flex-start;
			overflow-x: auto;
			white-space: nowrap;
		}

		.log-item {
			padding: var(--spacing-md);
		}

		.log-title {
			font-size: 1.125rem;
		}

		.log-meta {
			flex-direction: column;
			align-items: flex-start;
			gap: var(--spacing-xs);
		}
	}
</style>

<script>
	// Search and Filter functionality
	const searchInput = document.getElementById('search-input');
	const filterButtons = document.querySelectorAll('.filter-btn');
	const logItems = document.querySelectorAll('.log-item');

	function filterItems() {
		const searchTerm = searchInput.value.toLowerCase().trim();
		const activeCategory = document.querySelector('.filter-btn.active')?.dataset.category || 'all';

		logItems.forEach(item => {
			const title = item.dataset.title || '';
			const content = item.dataset.content || '';
			const tags = item.dataset.tags || '';
			const category = item.dataset.category || '';

			const matchesSearch = searchTerm === '' ||
				title.includes(searchTerm) ||
				content.includes(searchTerm) ||
				tags.includes(searchTerm);

			const matchesCategory = activeCategory === 'all' || category === activeCategory;

			if (matchesSearch && matchesCategory) {
				item.style.display = 'block';
			} else {
				item.style.display = 'none';
			}
		});
	}

	// Search input event listener
	searchInput.addEventListener('input', filterItems);

	// Filter functionality
	filterButtons.forEach(button => {
		button.addEventListener('click', () => {
			const category = button.dataset.category;

			// Update active button
			filterButtons.forEach(btn => btn.classList.remove('active'));
			button.classList.add('active');

			// Apply filter
			filterItems();
		});
	});
</script>